---
layout: single
title:  "(DB)테이블 정규화"
categories: Review
tags: Review, DB
---

DB 정규화
---
테이블을 만들고 여러가지 데이터들을 다룰 때 거의 필수라고 할 수 있는 테이블 정규화에 대해서 복습해보도록 하겠습니다.   

저는 개인적으로 테이블 정규화하는 방법을 처음 배웠을 때 어렵고 헷갈려 했었는데, 나름대로 공부하면서 얻은 팁으로 지금은 테이블 정규화 하는 것을 어려워하지 않게 됐습니다. 


#### 정규화
---

- 정규화란?
- 정규화를 하는 이유는?  
- 정규화 하는 방법
  
  

#### 정규화란?
---

> 정규화란 이상현상이 있는 릴레이션을 분해하여 이상현상을 없애는 과정이다. 이상현상이 존재하는 릴레이션을 분해하여 여러 개의 릴레이션을 생성하게 된다. 이를 구분하여 정규형이 높아질수록 이상현상은 줄어들게 된다.
>
> 즉, __<u>쉽게말하면 테이블 간에 중복된 데이터를 허용하지 않는다는 것이다.</u>__ 중복된 데이터를 허용하지 않음으로써 무결성(Integrity)를 유지할 수 있으며, DB의 저장 용량 역시 줄일 수 있다. 이러한 테이블을 분해하는 정규화 단계가 정의 되어 있다.
>    
> 참고문헌: 인성의 개발 공부 노트 [DataBase] 정규화(1NF, 2NF, 3NF, BCNF)


#### 정규화를 하는 이유는?
---

테이블 정규화를 하지 않으면 테이블간 데이터를 다룰 때 효율성이 떨어지는데 만약 정규화를 하지않은 상태에서 중복된 데이터를 수정해야 한다면 그 중복된 데이터가 들어있는 모든 테이블에 들어가서 데이터를 일일이 수정해야 합니다.   

그래서 정규화를 해서 중복된 값들을 하나로 합쳐서 데이터들을 관리하기 편하게 합니다.


#### 정규화 하는 방법?
---

- 제가 수업시간에 했던 예제로 정규화를 해보겠습니다.

![스크린샷 2024-07-09 120217](https://github.com/burgundy02/git-practice/assets/155533879/37dcb83a-b1dd-4134-bb41-1eb9fec2f21e)

우선 이런 테이블이 있습니다. 이 테이블에는 많은 데이터들이 들어가 있기 때문에 정규화를 하지 않으면 그 많은 데이터들을 다루기 힘들어 질 것입니다.


---
#### 정규화 하는 방법?
![스크린샷 2024-07-09 120217](https://github.com/user-attachments/assets/d75954d3-bedf-479a-ab9d-90e77970de9b)

그렇다면 이제 정규화를 할건데, 정규화를 할 때 어떤 칼럼을 정규화 해야할지 정해야 합니다.

칼럼에 따라서 정규화를 해야하는 칼럼도 있지만 정규화를 하면 안되는 칼럼도 존재하기 때문에 정규화를 하기에 앞서 이 과정도 중요하다고 볼 수 있습니다.

##### 1-1 정규화 비대상
---
![스크린샷 2024-07-15 170957](https://github.com/user-attachments/assets/6399e089-f6e5-4eee-8025-3869fcb98508)

먼저 정규화를 하면 안되는 비대상 칼럼입니다.   

주황색 표시한 칼럼들이 정규화를 하면 안되는 칼럼인데   
테이블에서 칼럼에 중복된 값들이 들어 있다고 무조건 다 정규화를 하면 안됩니다.    

정규화는 테이블의 데이터를 효율적으로 관리하기 위해서 하는 건데
무작정 중복된 데이터들을 다 정규화하게 되면 오히려 관리하기 힘들어집니다.


###### 정규화 하면 안되는 이유

- 등록번호   
    테이블 정규화를 하는 이유는 중복된 데이터들을 관리하기 위해서인데 등록번호는 중복된 값이 존재하지 않으므로 정규화하지 않습니다.

- 제목   
    제목은 확실히 중복된 값이 칼럼에 존재할 수 있습니다.    
    하지만 제목이 중복 됐다고 같은 값은 아닙니다. 즉, 제목은 같지만 완전히 다른 dvd인데 정규화를 해버리면 다른 dvd가 같은 dvd로 되어버려서 정규화하면 안됩니다.

- 발행년   
    일단 발행년은 정규화하기에는 너무 광범위합니다.   
    그리고 만약 발행년을 정규화했고 정규화한 것들 중  2003년에 발행된 dvd 중 하나가 사실 2002에 발행됐어야 했는데 표기 실수를 해서 수정을 해야한다고 가정한다면 정규화를 했기 때문에 수정할 dvd 하나만 수정하고 싶어도 2003년에 발행된 모든 dvd까지 다 수정되는 불편한 상황이 생깁니다.  

- 데이터기준일자   
      발행년과 동일하게 너무 광범위하고, 데이터를 편리하게 관리하기 위해서 정규화를 하는건데 오히려 관리하기가 불편해집니다.
     

##### 1-2 정규화 대상
---
![스크린샷 2024-07-15 174456](https://github.com/user-attachments/assets/c0677690-2fc6-467e-afe0-f837ff90b0b1)

그렇다면 어떤 칼럼이 정규화 대상 칼럼인지 보겠습니다.   

초록색 표시한 칼럼이 정규화 대상 칼럼입니다.   
정규화 대상 칼럼은 일단 쉽게 생각해서 같은 이름의 다른 값이 없는 칼럼이라고 보면됩니다. 그래서 한 칼럼에 고유의 값이 모여져 있는 것을 정규화한다고 생각하면 쉽습니다.


###### 정규화 대상인 이유
- 제작자   
  만약 비엠코리아 제작이 오타가 나서 비엠코리아 지직으로 표기됐다고 하면, 정규화를 안했을 때는 제작자가 비엠코리아 지직인 제작자를 다 찾아가서 일일이 제작으로 수정해야 하는 번거로움이 있습니다.   
  그런데 정규화를 하면 한 번만 수정해도 오타난 것을 다 바꿀 수 있어서 효율적으로 관리할 수 있습니다.

- 발행자   
  제작자와 마찬가지로 수정, 삭제, 추가 등 데이터를 효율적으로 관리할 수 있습니다.


##### 2 정규화 하는 방법
---

위에서 테이블에서 어떤 칼럼을 정규화할지 정했다면 이제 본격적으로
정규화를 시작해 보겠습니다.   


###### 1) 
![스크린샷 2024-07-15 204956](https://github.com/user-attachments/assets/5998a775-4957-474d-a35a-09285237da3f)

 정규화 할 칼럼의 테이블을 따로 만들고,
 그 칼럼 이름을 테이블명으로 설정합니다.


###### 2)
![스크린샷 2024-07-15 210220](https://github.com/user-attachments/assets/aa8e8757-94cd-46eb-bc5e-ca4a4acc8cda)

정규화한 테이블의 칼럼에는 필수로 설정해줘야 하는 게 있습니다.
첫 번째는 테이블이름_id에 auto increment, primary key, not null (ai, pk, nn), 두 번째는 테이블이름_name에 not null, unique (nn, UQ)입니다.


###### 3)

정규화한 테이블의 칼럼에 기존 테이블에 있던 중복된 값들을 묶어서 가지고 와야합니다.(값은 정규화이니까 중복 없이 들고 와야합니다.)

```sql
insert into producer_tb

 select
	0,      
	제작자
from
	sample_dvd_tb
group by
	제작자;
```
위의 코드로 기존의 중복된 값들을 하나로 묶어서 정규화테이블에 들고 올 수 있는데



먼저 기존 테이블에서 이렇게 정규화할 칼럼을 조회 해 보면
```sql
select                  // 조회
	0,                  // id, AI했기 때문에 여기선 0을 넣어도 테이블에서는 1부터 증가 됨
	제작자              // 정규화할 칼럼
from
	sample_dvd_tb       // 기존 데이터들이 들어있는 테이블
group by
	제작자;             // 정규화할 칼럼
```


![스크린샷 2024-07-15 215157](https://github.com/user-attachments/assets/9c3fe0f4-1af1-4500-a8d1-086addae7c1b)

![스크린샷 2024-07-15 215303](https://github.com/user-attachments/assets/fdb240b2-c0f8-4743-bb59-9d4548b64972)

group by로 정규화할 칼럼의 중복된 값들을 하나로 묶어서 중복된 값들이 하나씩만 들어있게 조회했습니다.



그 다음에 위에서 처럼 중복 정리를 한 후 정리한 값들을 정규화 테이블에 insert into해서 값을 넣어줍니다.

![스크린샷 2024-07-15 215919](https://github.com/user-attachments/assets/6037bb45-5079-47ba-b0df-91d1b6fe0581)



이렇게 하면 정규화 테이블에 중복을 정리(제거)한 칼럼의 값들이 들어가서 조회하면 아래처럼 중복 없는 id(AI)와 중복이 정리된 칼럼(제작자)의 모습이 나옵니다.

![스크린샷 2024-07-15 220138](https://github.com/user-attachments/assets/77f66144-16d5-4f45-9b10-d13d88449fe1)   




###### 4)

이제 기존의 테이블에 정규화한 테이블 값의 id를 추가해서 두 테이블을 연결해 줍니다.   
-> 원래 테이블에서 producer_id(제작자), publisher_id(발행자)를 추가(보기 좋게 producer 앞에 추가)


left outer join해서 원래 칼럼에 추가한 id랑 같은 행에 정규화한 칼럼의 id가 오게 합니다.
(그래서 제작자, 발행자 칼럼삭제하고 그 자리에 id를 넣은게 아니라 id 칼럼 새로 추가)

``` sql
SELECT * FROM dvd_db.sample_dvd_tb;

select
	*
from
	sample_dvd_tb sdt
    left outer join producer_tb pdt on
    (pdt.producer_name = sdt.제작자)
    left outer join publisher_tb pbt on
    (pbt.publisher_name = sdt.발행자);
```


![스크린샷 2024-07-15 222021](https://github.com/user-attachments/assets/f57c9da6-a2ec-4f6e-b372-569e9ea6447c)

그러면 이렇게 join된 것을 확인 할 수 있습니다.


###### 6)

join하고 나서 수업시간에는 update하는 방법으로 기존의 테이블에 id값을 추가했었는데 이번에는 insert into방법으로 새로운 테이블에 내가 넣고 싶은 값들만 뽑아서 넣어보겠습니다.

```sql
insert into dvd_tb  // 새 테이블을 만들어서,
select
    0,              // 내가 넣고 싶은 값들만 뽑아서 새 테이블에 넣는다.
    등록번호,
    제목,
    producer_id,
    publisher_id,
    발행년,
    데이터기준일자
from
	sample_dvd_tb sdt
    left outer join producer_tb pdt
    on(pdt.producer_name = sdt.제작자)
    left outer join publisher_tb pbt 
    on(pbt.publisher_name = sdt.발행자);
    
```

이렇게 해서 아래의 사진처럼 정규화를 한 다음에 기존의 테이블과 정규화한 테이블을 연결하고 마지막에 insert into를 사용해서 
새로운 테이블에 내가 넣고 싶은 칼럼을 지정해서 정규화 된 값들을 넣었습니다.(*이미지처럼 결과가 나옵니다.)

![스크린샷 2024-07-15 224350](https://github.com/user-attachments/assets/2ef40219-1892-483b-aaca-ee6d41a394f1)


###### 7)

이렇게 하면 정규화한 제작자, 발행자가 수정돼도 정규화테이블에서 id값만 바꾸면 그 아이디를 가지고 있는 다른 값들도 같이 바꿀 수 있어서 효율적으로 데이터를 관리 할 수 있습니다.

이상 정규화 복습이었습니다.

